import { describe, expect, test } from "vitest";
import { formatAsAccordion } from "../../../../src/app/utils/github/comments";

describe("formatAsAccordion", () => {
	test("ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æŠ˜ã‚ŠãŸãŸã¿å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹", () => {
		const content = "ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„";
		const formatted = formatAsAccordion(content);

		expect(formatted).toBe(`<details>
<summary>
<h4>ğŸ’¡ è©³ç´°ã‚’è¡¨ç¤º</h4>
</summary>

ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„
</details>

`);
	});

	test("ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŒ‡å®šã—ã¦æŠ˜ã‚ŠãŸãŸã¿ã‚’ä½œæˆã™ã‚‹", () => {
		const content = "ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„";
		const formatted = formatAsAccordion(content, {
			title: "ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒˆãƒ«",
		});

		expect(formatted).toBe(`<details>
<summary>
<h4>ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒˆãƒ«</h4>
</summary>

ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„
</details>

`);
	});

	test("ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æƒ…å ±ä»˜ãã§æŠ˜ã‚ŠãŸãŸã¿ã‚’ä½œæˆã™ã‚‹", () => {
		const content = "ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„";
		const formatted = formatAsAccordion(content, {
			provider: "openai",
		});

		expect(formatted).toBe(`<details>
<summary>
<h4>ğŸ’¡ è©³ç´°ã‚’è¡¨ç¤º</h4>
</summary>

ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„
</details>

(generated by openai)`);
	});

	test("ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®çµµæ–‡å­—ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦æŠ˜ã‚ŠãŸãŸã¿ã‚’ä½œæˆã™ã‚‹", () => {
		const content = "ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„";
		const formatted = formatAsAccordion(content, {
			provider: "openai",
		});

		expect(formatted).toBe(`<details>
<summary>
<h4>ğŸ’¡ è©³ç´°ã‚’è¡¨ç¤º</h4>
</summary>

ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„
</details>

(generated by openai)`);
	});

	test("è¤‡æ•°è¡Œã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ­£ã—ãæŠ˜ã‚ŠãŸãŸã¿å½¢å¼ã«ã™ã‚‹", () => {
		const content = `1è¡Œç›®
2è¡Œç›®
3è¡Œç›®`;
		const formatted = formatAsAccordion(content);

		expect(formatted).toBe(`<details>
<summary>
<h4>ğŸ’¡ è©³ç´°ã‚’è¡¨ç¤º</h4>
</summary>

1è¡Œç›®
2è¡Œç›®
3è¡Œç›®
</details>

`);
	});

	test("ã™ã¹ã¦ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦æŠ˜ã‚ŠãŸãŸã¿ã‚’ä½œæˆã™ã‚‹", () => {
		const content = "ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„";
		const formatted = formatAsAccordion(content, {
			title: "ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒˆãƒ«",
			provider: "gemini",
		});

		expect(formatted).toBe(`<details>
<summary>
<h4>ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒˆãƒ«</h4>
</summary>

ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„
</details>

(generated by gemini)`);
	});

	test("Markdownå½¢å¼ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¿æŒã—ã¦æŠ˜ã‚ŠãŸãŸã¿ã‚’ä½œæˆã™ã‚‹", () => {
		const content = `# è¦‹å‡ºã—

- ãƒªã‚¹ãƒˆé …ç›®1
- ãƒªã‚¹ãƒˆé …ç›®2

\`\`\`typescript
const code = "ã‚µãƒ³ãƒ—ãƒ«";
\`\`\``;
		const formatted = formatAsAccordion(content);

		expect(formatted).toBe(`<details>
<summary>
<h4>ğŸ’¡ è©³ç´°ã‚’è¡¨ç¤º</h4>
</summary>

# è¦‹å‡ºã—

- ãƒªã‚¹ãƒˆé …ç›®1
- ãƒªã‚¹ãƒˆé …ç›®2

\`\`\`typescript
const code = "ã‚µãƒ³ãƒ—ãƒ«";
\`\`\`
</details>

`);
	});
});
